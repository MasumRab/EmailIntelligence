# Data Model: History Analysis

**Feature**: `001-history-analysis`
**Date**: 2025-11-11

This document outlines the data entities for the History Analysis feature, based on the feature specification.

## Entity: Commit

Represents a single change in the repository history.

| Field | Type | Description | Validation Rules |
|---|---|---|---|
| `hexsha` | string | The full 40-character SHA-1 hash of the commit. | Must be a valid SHA-1 hash. |
| `message` | string | The full commit message. | N/A |
| `author_name` | string | The name of the commit author. | N/A |
| `author_email` | string | The email of the commit author. | Must be a valid email format. |
| `authored_date` | datetime | The timestamp when the commit was authored. | Must be a valid ISO 8601 datetime. |
| `code_changes` | list[CodeChange] | A list of code changes included in this commit. | N/A |

## Entity: CodeChange

Represents the specific modifications to a single file within a commit.

| Field | Type | Description | Validation Rules |
|---|---|---|---|
| `change_type` | string | The type of change: 'A' (Added), 'D' (Deleted), 'M' (Modified), 'R' (Renamed), 'T' (Type Changed). | Must be one of the valid change type characters. |
| `old_path` | string | The file path before the change. Null for added files. | N/A |
| `new_path` | string | The file path after the change. Null for deleted files. | N/A |
| `diff` | string | The textual representation of the changes (the diff). | N/A |

## Entity: ActionDescription

A narrative summary, generated by the system, that explains the purpose and effect of a commit or a series of commits.

| Field | Type | Description | Validation Rules |
|---|---|---|---|
| `commit_hexsha` | string | The SHA of the commit this description pertains to. | Must be a valid SHA-1 hash. |
| `title` | string | A one-line summary of the action. | Max 72 characters. |
| `narrative` | string | A detailed, synthesized narrative explaining the 'what' and 'why' of the changes, based on both the commit message and the code changes. | N/A |
| `is_consistent` | boolean | A flag indicating if the commit message and code changes were found to be consistent. | N/A |
| `discrepancy_notes` | string | If `is_consistent` is false, this field contains notes on the identified discrepancies. | Required if `is_consistent` is false. |

## Relationships

- A `Commit` has a one-to-many relationship with `CodeChange`.
- An `ActionDescription` has a one-to-one relationship with a `Commit`.
