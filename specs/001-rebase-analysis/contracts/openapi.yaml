openapi: 3.0.0
info:
  title: Rebase Analysis and Intent Verification API
  version: 1.0.0
  description: API for analyzing Git rebase operations, reconstructing commit history, inferring original intentions, and verifying merged changes.

servers:
  - url: /api/v1
    description: Local development server

paths:
  /analyze/rebase:
    post:
      summary: Analyze a rebased branch
      description: Reconstructs the chronological story of changes and infers original intentions for a given rebased branch.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - branch_name
              properties:
                branch_name:
                  type: string
                  description: The name of the rebased branch to analyze.
                repo_path:
                  type: string
                  description: Optional. The path to the Git repository. Defaults to current working directory.
      responses:
        '200':
          description: Analysis successful.
          content:
            application/json:
              schema:
                type: object
                properties:
                  chronological_story:
                    type: array
                    items:
                      $ref: '#/components/schemas/Commit'
                    description: A chronological list of commits with inferred intentions.
                  intentions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Intention'
                    description: List of inferred intentions.
        '400':
          description: Invalid request or branch not found.

  /verify/merge:
    post:
      summary: Verify merged changes against original intentions
      description: Compares merged changes in a target branch with the original intentions inferred from a rebased branch.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - rebased_branch_name
                - merged_branch_name
              properties:
                rebased_branch_name:
                  type: string
                  description: The name of the original rebased branch.
                merged_branch_name:
                  type: string
                  description: The name of the branch where the rebased branch was merged.
                repo_path:
                  type: string
                  description: Optional. The path to the Git repository. Defaults to current working directory.
      responses:
        '200':
          description: Verification successful.
          content:
            application/json:
              schema:
                type: object
                properties:
                  discrepancies:
                    type: array
                    items:
                      $ref: '#/components/schemas/Discrepancy'
                    description: List of identified discrepancies.
                  verification_report:
                    type: string
                    description: A summary report of the verification.
        '400':
          description: Invalid request or branches not found.

  /branches/rebased:
    get:
      summary: Identify rebased branches
      description: Scans the repository to identify branches that have recently undergone a rebase operation.
      parameters:
        - in: query
          name: repo_path
          schema:
            type: string
          description: Optional. The path to the Git repository. Defaults to current working directory.
      responses:
        '200':
          description: List of rebased branches.
          content:
            application/json:
              schema:
                type: object
                properties:
                  rebased_branches:
                    type: array
                    items:
                      type: string
                    description: List of branch names identified as rebased.
        '400':
          description: Invalid request.

components:
  schemas:
    Commit:
      type: object
      properties:
        hash:
          type: string
          description: Unique identifier for the commit.
        author:
          type: string
          description: Author of the commit.
        message:
          type: string
          description: Commit message.
        timestamp:
          type: string
          format: date-time
          description: When the commit was made.
        changes:
          type: array
          items:
            type: object
            properties:
              file_path:
                type: string
              line_changes:
                type: array
                items:
                  type: string
          description: List of files and lines changed.
        parents:
          type: array
          items:
            type: string
          description: Hashes of parent commits.
    Intention:
      type: object
      properties:
        summary:
          type: string
          description: A brief description of the intention.
        source:
          type: string
          description: Where the intention was inferred from (e.g., "commit message", "PR #123", "Jira-XYZ").
        related_commits:
          type: array
          items:
            type: string
          description: Hashes of commits related to this intention.
    Discrepancy:
      type: object
      properties:
        type:
          type: string
          description: Type of discrepancy (e.g., "functional_change", "structural_change").
        description:
          type: string
          description: Detailed explanation of the discrepancy.
        original_intention:
          $ref: '#/components/schemas/Intention'
          description: Reference to the Intention that was deviated from.
        merged_changes_ref:
          type: string
          description: Reference to the specific changes in the merged branch (e.g., commit hash, diff range).
