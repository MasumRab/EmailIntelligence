#!/bin/bash
# Git post-commit hook for documentation synchronization and Agent Workflow triggering
# This hook runs after each commit to keep documentation synchronized and trigger Agent Workflows

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# Check if this is a documentation-related commit
if git diff-tree --no-commit-id --name-only HEAD | grep -q "^docs/\|^backlog/"; then
    echo "Documentation changes detected, running sync and Agent Workflows..."

    # Run the sync script
    if python "$SCRIPT_DIR/auto_sync_docs.py" --run-once; then
        echo "Documentation sync completed successfully"
    else
        echo "Warning: Documentation sync failed"
    fi

    # Trigger Agent Workflow components for documentation processing
    echo "Triggering Agent Workflow components..."
    
    # Run maintenance checks on updated documentation
    if python -c "
try:
    from maintenance_scheduler import MaintenanceScheduler
    scheduler = MaintenanceScheduler()
    # This would normally check for documentation changes and schedule maintenance tasks
    print('Maintenance scheduler ready for documentation processing')
except Exception as e:
    print(f'Maintenance scheduler not available: {e}')
"; then
        echo "Maintenance scheduler initialized"
    else
        echo "Maintenance scheduler initialization failed"
    fi

    # Note: In a full implementation, we would trigger specific Agent Workflow tasks here
    # For example:
    # - Trigger documentation review workflows for changed docs
    # - Trigger translation workflows for new content
    # - Trigger documentation generation for updated templates
    
else
    echo "No documentation changes detected, skipping sync and Agent Workflows"
fi