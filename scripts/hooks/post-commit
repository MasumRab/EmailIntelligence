#!/bin/bash

# Post-commit hook for worktree orchestration
# Runs synchronization scripts after commits to orchestration-tools branch
# Can be enabled/disabled on any branch via: git config hooks.orchestration-tools.enable [true/false]

set -e

# Get current branch
CURRENT_BRANCH="$(git rev-parse --abbrev-ref HEAD)"

# Check if orchestration hooks are explicitly enabled on this branch
HOOKS_ENABLED=$(git config --get hooks.orchestration-tools.enable || echo "default")

# Determine if we should run hooks (default: only on orchestration-tools)
SHOULD_RUN=false
if [[ "$HOOKS_ENABLED" == "true" ]]; then
    SHOULD_RUN=true
elif [[ "$HOOKS_ENABLED" != "false" ]] && [[ "$CURRENT_BRANCH" == "orchestration-tools" ]]; then
    SHOULD_RUN=true
fi

# Only run sync if enabled and sync script exists
if [[ "$SHOULD_RUN" == true ]] && [[ -f "scripts/sync_setup_worktrees.sh" ]]; then
    echo "Setup synchronization triggered after commit"
    read -p "Run synchronization to update worktrees? (y/N): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        bash scripts/sync_setup_worktrees.sh
    else
        echo "Synchronization skipped."
    fi
fi
