#!/bin/bash

# Post-checkout hook to automatically set up environment on main/scientific branches

BRANCH=$(git rev-parse --abbrev-ref HEAD)

if [[ "$BRANCH" != "orchestration-tools" ]]; then
    echo "Checking out $BRANCH branch. Syncing canonical orchestration files..."
    git checkout orchestration-tools -- setup/ scripts/hooks/ scripts/sync_setup_worktrees.sh .gitattributes .gitignore launch.bat launch.py launch.sh pyproject.toml requirements.txt requirements-dev.txt --quiet
    echo "Orchestration files updated to canonical versions."
fi

if [[ "$BRANCH" == "main" || "$BRANCH" == "scientific" ]]; then
    echo "Checking out $BRANCH branch. Running environment setup..."
    if command -v python &> /dev/null; then
        python launch.py --setup --skip-prepare > /dev/null 2>&1 &
        echo "Setup started in background. Check logs for status."
    else
        echo "Python not found, skipping setup."
    fi
fi
