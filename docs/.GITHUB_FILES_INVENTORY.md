# .github Folder Protection & Synchronization Inventory

## Overview

The `.github/` folder contains critical configuration, instructions, and automation for the project. This document tracks all `.github` files and their orchestration protection status.

**Status:** All files are now protected and will be synchronized via orchestration approval system.

---

## File Inventory

### Agent Instructions (CRITICAL - Auto-Synced)
Directory: `.github/instructions/`

These files provide AI agent and Copilot instructions and are **essential for development workflow**:

| File | Size | Purpose | Protected |
|------|------|---------|-----------|
| `taskmaster.instructions.md` | 42KB | Task Master AI agent instructions | ✅ YES - Directory sync |
| `dev_workflow.instructions.md` | 30KB | Development workflow guidance | ✅ YES - Directory sync |
| `self_improve.instructions.md` | 2.5KB | Self-improvement patterns | ✅ YES - Directory sync |
| `vscode_rules.instructions.md` | 1.5KB | VSCode-specific rules | ✅ YES - Directory sync |
| `tools-manifest.json` | 9KB | Tool configuration and registry | ✅ YES - Directory sync |

**Protection Level:** CRITICAL - Full directory sync (`git checkout orchestration-tools -- .github/instructions/`)

---

### GitHub Workflows (CI/CD Automation)
Directory: `.github/workflows/`

| File | Purpose | Protected |
|------|---------|-----------|
| `lint.yml` | Python linting (flake8, pylint, black) | ✅ YES - Individual sync |
| `test.yml` | Python testing (pytest) | ✅ YES - Individual sync |
| `extract-orchestration-changes.yml` | Extract changes from orchestration-tools | ✅ YES - Individual sync |

**Protection Level:** HIGH - Individual file sync prevents CI/CD breakage

---

### Pull Request Templates
File: `.github/pull_request_templates/orchestration-pr.md`

Provides template for orchestration-related pull requests.

**Protection Level:** MEDIUM - Individual file sync

---

### GitHub Configuration Files

| File | Purpose | Protected |
|------|---------|-----------|
| `BRANCH_PROPAGATION_POLICY.md` | Documents branch propagation rules | ✅ YES |
| `PROPAGATION_SETUP_CHECKLIST.md` | Setup checklist for propagation | ✅ YES |
| `DOCUMENTATION_DISTRIBUTION_REPORT.md` | Report on doc distribution status | ✅ YES |

**Protection Level:** MEDIUM - Configuration and policy documentation

---

## Synchronization Status

### Across All Branches

All `.github` files are **identical** on:
- `main`
- `scientific`
- `orchestration-tools`

This means:
- ✅ No branch-specific variations
- ✅ Safe to sync without conflicts
- ✅ Uniform CI/CD and instructions across branches

### Auto-Sync Mechanism

When you switch branches or merge, orchestration will:

1. **Detect Changes**: Check if `.github` files differ
2. **Display Summary**: Show what's being synchronized
3. **Await Approval**: Prompt user to approve/deny
4. **Sync on Approval**: Copy files from orchestration-tools
5. **Log Decision**: Record action to `.git/hooks/.orchestration_log`

Example prompt:
```
=== Orchestration File Updates ===
The following directories will be synchronized:
  → .github/instructions/ (all contents)

The following files will be updated from orchestration-tools:
  → .github/workflows/lint.yml
  → .github/workflows/test.yml
  → .github/BRANCH_PROPAGATION_POLICY.md
  
Proceed with orchestration synchronization? (y/n)
```

---

## Why This Matters

### Agent Instructions Loss Prevention
Before this protection, switching to orchestration-tools and back could result in:
- ❌ Lost Copilot instructions
- ❌ Broken agent workflow guidance
- ❌ Missing tool configuration
- ❌ Lost development patterns

Now:
- ✅ Instructions always synced
- ✅ User approval required
- ✅ Actions logged for audit
- ✅ Can be denied if needed

### CI/CD Stability
Workflow files are critical:
- `.github/workflows/lint.yml` - Controls code quality checks
- `.github/workflows/test.yml` - Controls test automation
- `.github/workflows/extract-orchestration-changes.yml` - Orchestration automation

Syncing ensures:
- ✅ Consistent CI/CD across branches
- ✅ No accidental breaking changes to workflows
- ✅ User awareness of workflow updates
- ✅ Recovery point (previous version in git history)

---

## File Status Matrix

| File Path | File Size | Protected | Sync Method | Protected Level |
|-----------|-----------|-----------|-------------|-----------------|
| `.github/instructions/` | 85KB | ✅ YES | Directory full sync | CRITICAL |
| `.github/workflows/lint.yml` | - | ✅ YES | Individual file sync | HIGH |
| `.github/workflows/test.yml` | - | ✅ YES | Individual file sync | HIGH |
| `.github/workflows/extract-orchestration-changes.yml` | - | ✅ YES | Individual file sync | HIGH |
| `.github/pull_request_templates/orchestration-pr.md` | - | ✅ YES | Individual file sync | MEDIUM |
| `.github/BRANCH_PROPAGATION_POLICY.md` | - | ✅ YES | Individual file sync | MEDIUM |
| `.github/PROPAGATION_SETUP_CHECKLIST.md` | - | ✅ YES | Individual file sync | MEDIUM |
| `.github/DOCUMENTATION_DISTRIBUTION_REPORT.md` | - | ✅ YES | Individual file sync | MEDIUM |

---

## Verification Commands

View all protected `.github` files:
```bash
# Lists all files that will be synced from orchestration-tools
git ls-tree -r orchestration-tools --name-only | grep "^\.github/"
```

Check current `.github` status:
```bash
# Lists local .github files
ls -la .github/
find .github/ -type f
```

View approval log for `.github` syncs:
```bash
grep "\.github" .git/hooks/.orchestration_log
```

Manually sync if needed:
```bash
# Sync all .github instructions
git checkout orchestration-tools -- .github/instructions/

# Sync workflows
git checkout orchestration-tools -- .github/workflows/

# Sync all .github
git checkout orchestration-tools -- .github/
```

---

## Implementation Details

### Where Protection Is Implemented

**Approval Library:** `scripts/lib/orchestration-approval.sh`
- Function: `collect_changed_files()` - includes 4 `.github` files
- Function: `collect_changed_directories()` - includes `.github/instructions/`

**Hooks:** 
- `.git/hooks/post-checkout` - Syncs on branch checkout
- `.git/hooks/post-merge` - Syncs on merge completion

**Approval System:**
- Interactive prompt before sync
- 30-second timeout (auto-deny if no response)
- Logged to `.git/hooks/.orchestration_log`
- Respects `ORCHESTRATION_APPROVAL_PROMPT=false` env var

---

## Rollback/Recovery

If you deny a sync but later need the updated files:

```bash
# Option 1: Manually checkout latest
git checkout orchestration-tools -- .github/instructions/

# Option 2: Force orchestration on next operation
ORCHESTRATION_APPROVAL_PROMPT=false git checkout main

# Option 3: See what changed
git diff orchestration-tools HEAD -- .github/
```

View what was approved/denied:
```bash
cat .git/hooks/.orchestration_log | tail -20
```

---

## Related Documentation

- `ORCHESTRATION_APPROVAL.md` - Full orchestration approval system documentation
- `ORCHESTRATION_APPROVAL_QUICK_REFERENCE.md` - Quick reference guide
- `.github/BRANCH_PROPAGATION_POLICY.md` - Branch propagation rules
